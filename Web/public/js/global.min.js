wf.define("meetingTime",[],function(){return function(){var f=8,i=17,n=10,t=":",r='<li data-value="{0}" class="wf-select-option {2}">{1}<\/li>',u=function(){return{toTime:n=>{var i=n%60;return Math.floor(n/60)+t+(i<10?"0"+i:i)},toMinutes:n=>{var i=n.split(t);return parseInt(i[0])*60+parseInt(i[1])}}}();return{render:function(e,o){var a=[],h=new Date,v=h.getHours(),b=h.getMinutes(),y=24,p=60,w=h.format("yyyy-MM-dd")==e,c,s,l;if(v>=i&&w)return r.format("","下班");for(o&&(c=o.split(t),y=parseInt(c[0]),p=parseInt(c[1])),s=w?Math.min(v,y)*60+Math.ceil(Math.min(b,p)/n)*n:f*60;s<=i*60;s=s+n)l=u.toTime(s),a.push(r.format(l,l,s===u.toMinutes(o)?"wf-select-option-selected":""));return a.join("")}}}()});wf.define("meeting",[],function(){return(()=>{var n=(n,t,i)=>{$.post(n,t,n=>{$.isFunction(i)&&i(n)})};return{save:(t,i)=>{n("meeting/save",t,i)},remove:(t,i)=>{n("meeting/delete",{id:t},i)}}})()});wf.define("meetingCheck",[],function(){return function(){var n=function(n){return n.substring(0,1)>1&&(n="0"+n),n};return{check:function(t,i){return(t.startTime=n(t.startTime),t.endTime=n(t.endTime),i.startTime=n(i.startTime),i.endTime=n(i.endTime),t.endTime<=t.startTime)?!1:t.date==i.date&&t.tableRoom==i.tableRoom?t.startTime>=i.endTime||t.endTime<=i.startTime?!0:!1:!0}}}});wf.define("meetingCard",[],function(){var n=wf.require("meeting"),t=wf.require("meetingTime"),i=wf.require("meetingCheck");return function(r,u,f){var e=u.find(".meeting-save"),y=u.find(".meeting-delete"),p=u.find(".meeting-startTime"),w=u.find(".meeting-endTime"),b=$(".meeting-date"),a="meeting-saved",o="meeting-edit",h="meeting-editing",c=".meeting-list-wrapper",l="meeting-error",s=n=>u.find('[name="{0}"]'.format(n)),v=function(n){return n.substring(0,1)>1&&(n="0"+n),n},k=function(){var i=["tableRoom","startTime","endTime"],n={date:f},t=[];return e.parents(".meeting-card").siblings(".meeting-saved").each(function(){var u=[],r;for($(this).find(".wf-select-input").each(function(){var n=$(this);u.push(n.val())}),r=0;r<u.length;r++)n[i[r]]=u[r];t.push(n)}),t},d=function(){var t={},n={date:f},u,c,r;if(["id","title","userName","tableRoom","startTime","endTime"].forEach(n=>{t[n]=s(n)}),!t.title.val())return t.title.focus(),null;if(!t.userName.val())return t.userName.focus(),null;for(u in t)n[u]=t[u].val();var a=i(),h=k(),o=!0;if(n.startTime=v(n.startTime),n.endTime=v(n.endTime),n.endTime<=n.startTime){o=!1;c=e.parent().prev().find(".wf-select-selection").addClass(l);setTimeout(function(){c.removeClass(l)},2e3);return}for(r=0;r<h.length;r++)a.check(n,h[r])||(o=!1,e.parent().parent().addClass(l),setTimeout(function(){e.parent().parent().removeClass(l)},2e3));if(o)return n},g=function(){b.each(function(){$(this).text()=="History"&&($(this).siblings().find(".meeting-date").removeClass("hide"),$(this).siblings(u).hover(function(){$(this).find("."+o).children().hide()},function(){$(this).find("."+o).children().hide()}))})};return g(),p.find(".time-option").html(t.render(f,s("startTime").val())),w.find(".time-option").html(t.render(f,s("endTime").val())),e.click(function(){var t=d();t&&n.save(t,n=>{n.success?(t.id||s("id").val(n.id),e.parent().parent().addClass(a),u.closest(c).removeClass(h)):$("#message-trigger").click()})}),y.click(function(){var t=s("id").val(),i=function(){u.closest(c).removeClass(h);u.remove()};t?n.remove(t,n=>{n.success&&i()}):i()}),u.hover(function(){$(this).hasClass(a)&&$(this).find("."+o).show()},function(){$(this).find("."+o).hide()}),u.find("."+o+" .wf-btn").click(function(){u.removeClass(a).closest(c).addClass(h);$(this).parent().hide()}),{addTo:function(n){n.append(u);u.closest(c).addClass(h)}}}});wf.require("page").render("meetingBorad",["UI.Select","UI.Modal"],function(){var n=this,t="meeting-temp",i=wf.require("meetingCard"),r=$("."+t).remove().removeClass(t),u;r.find("[data-rendered]").removeAttr("data-rendered");$(".meeting-add").click(function(){var t=$(this),u=r.clone(),f=t.prev().find(".meeting-date").html(),e=i(t,u,f);e.addTo(t.prev());n.refresh()});u=$(".meeting-board-wrapper").find(".meeting-card");$.each(u,function(){i("",$(this),$(this).parent().find(".meeting-date").html())});n.refresh()});